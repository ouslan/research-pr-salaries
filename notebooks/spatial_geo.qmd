---
title: "Agriculture processing"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import os
os.chdir("..")
```

```{python}
from src.data.data_process import DataReg
import ibis 
import geopandas as gpd

dr = DataReg()

ibis.options.interactive = True
```

```{python}
dr.make_spatial_table()
```

```{python}
gdf = gpd.read_file("data/external/zip_shape.zip")
gdf = gdf[["ZCTA5CE20", "geometry"]].rename(columns={"ZCTA5CE20":"zipcode"}).reset_index(drop=True)
gdf
```

```{python}
zips = gpd.read_file("data/external/zip_shape.zip", engine="pyogrio")
zips = zips[zips["ZCTA5CE20"].str.startswith("00")]
zips['geometry'] = zips['geometry'].apply(lambda geom: MultiPolygon([geom]) if isinstance(geom, Polygon) else geom)
df = zips[["ZCTA5CE20", "geometry"]].rename(columns={"ZCTA5CE20":"zipcode"}).reset_index(drop=True)
```

```{python}
df[df["zipcode"] == "00936"]
```