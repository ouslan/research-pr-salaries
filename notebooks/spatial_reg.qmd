---
title: "Agriculture processing"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import os
os.chdir("..")
```

```{python}
from pysal.lib import weights
import geopandas as gpd
```

```{python}
d.semipar_data().to_parquet("data/external/test.parquet")
```

```{python}
gdf = gpd.read_parquet("data/external/test.parquet")
```

```{python}
tmp = gdf[gdf["k_index"] < 2]
tmp = tmp[["geom", "k_index", "name", "naics2", "year"]].reset_index(drop=True)
tmp = tmp[(tmp["naics2"].isin(["52"]))]
tmp["centroid"] = tmp.centroid
tmp
```

```{python}
tmp = tmp.sort_values(["year"])
tmp = tmp[(tmp["year"] == 2023)]
w = weights.distance.DistanceBand.from_dataframe(
    tmp, 80467, binary=True
)
```

```{python}
indipendant_var = [ "median_household_income_dollars", "k_index",
                    "unemployed", "mean_travel_time_to_work_minutes", "armed_forces", "food_security", "p_public_administration", "p_with_social_security",
                    "p_agriculture_forestry_fishing_a", "p_professional_scientific_and_ma", "p_manufacturing", "p_construction", "p_snap", "p_information",
                    "not_in_labor_force", "mean_cash_public_assistance_inco", "p_retirement"]
indipendant_name = [s[:15] for s in indipendant_var]

y_reshaped = master_gdf["total_employment"].values.reshape(-1, 1)
x_reshaped = (master_gdf[indipendant_var]).values
fe_lag = spreg.Panel_FE_Lag(
    y=y_reshaped, 
    x=x_reshaped, 
    w=w, 
    name_y=["employment"], 
    name_x=indipendant_name, 
    name_ds="NAT")
print(fe_lag.summary)
```


```{python}
print(fe_lag.summary)
```


```{python}
master_gdf[indipendant_var + ["total_employment"]].describe()
```