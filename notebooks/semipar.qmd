---
title: "Agriculture processing"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import os
os.chdir("..")
```

```{python}
from src.data.data_process import DataReg
from pygam import PoissonGAM, s, te, LinearGAM,GAM
import matplotlib.pyplot as plt
from mpl_toolkits import mplot3d
import pandas as pd
import numpy as np
import ibis

ibis.options.interactive = True
```

```{python}
d = DataReg()
df = d.semipar_data()
```

```{python}
df = df.select(["year", "qtr", "ein", "total_employment", "p_snap", "car_truck_or_van_nn_drove_alone", "p_with_social_security", "population_16_years_and_over", "own_children_under_6_years", "own_children_6_to_17_years", "with_supplemental_security_incom"]).to_pandas()
```

```{python}
var = ["p_snap", "car_truck_or_van_nn_drove_alone", "p_with_social_security", "population_16_years_and_over", "own_children_under_6_years", "own_children_6_to_17_years", "with_supplemental_security_incom"]
gam = GAM(s(0, n_splines=200) + te(6, 1) + s(2)).fit(df[var].values, df[["total_employment"]].values)
gam.summary()
```

```{python}
plt.ion()
plt.rcParams['figure.figsize'] = (12, 8)
XX = gam.generate_X_grid(term=1, meshgrid=True)
Z = gam.partial_dependence(term=1, X=XX, meshgrid=True)

ax = plt.axes(projection='3d')
ax.plot_surface(XX[0], XX[1], Z, cmap='viridis')
```